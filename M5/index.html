<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏õ‡∏è‡∏¥‡∏ó‡∏¥‡∏ô‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ôM.5</title>
    <style>
        :root {
            color-scheme: light dark;
            --accent: #3d7eff;
            --accent-dark: #2b5ccd;
            --bg: #f7f9fc;
            --text: #101828;
        }
        * {
            box-sizing: border-box;
            font-family: "Segoe UI", Tahoma, sans-serif;
        }
        body {
            margin: 0;
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        .app {
            width: min(920px, 100%);
            background: white;
            border-radius: 18px;
            padding: 32px;
            box-shadow: 0 20px 60px rgba(15, 23, 42, 0.12);
            display: grid;
            gap: 28px;
        }
        .calendar-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        .calendar-header button {
            border: none;
            background: var(--accent);
            color: white;
            width: 42px;
            height: 42px;
            border-radius: 12px;
            cursor: pointer;
            font-size: 18px;
        }
        .calendar-header button:active {
            transform: translateY(1px);
            background: var(--accent-dark);
        }
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 10px;
            text-align: center;
        }
        .weekday, .day {
            padding: 10px 0;
        }
        .weekday {
            font-weight: 600;
            color: #64748b;
        }
        .day {
            border-radius: 12px;
            cursor: pointer;
            position: relative;
        }
        .day:hover {
            background: rgba(61, 126, 255, 0.1);
        }
        .day.inactive {
            color: #cbd5f5;
            cursor: default;
        }
        .day.selected {
            background: var(--accent);
            color: white;
        }
        .day .indicator {
            width: 6px;
            height: 6px;
            background: var(--accent);
            border-radius: 50%;
            position: absolute;
            bottom: 8px;
            left: 50%;
            transform: translateX(-50%);
        }
        form {
            display: grid;
            gap: 12px;
        }
        label {
            font-size: 0.95rem;
            color: #475467;
        }
        input, textarea {
            width: 100%;
            padding: 12px;
            border-radius: 12px;
            border: 1px solid #d0d5dd;
            font-size: 1rem;
        }
        button[type="submit"] {
            background: var(--accent);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 12px;
            cursor: pointer;
            font-size: 1rem;
        }
        button[type="submit"]:hover {
            background: var(--accent-dark);
        }
        .events {
            border-top: 1px solid #eaecf5;
            padding-top: 20px;
        }
        .event-card {
            border: 1px solid #eaecf5;
            border-radius: 12px;
            padding: 14px 18px;
            margin-bottom: 12px;
            display: flex;
            justify-content: space-between;
            gap: 10px;
        }
        .event-card:last-child {
            margin-bottom: 0;
        }
        .status {
            font-size: 0.9rem;
            color: #475467;
        }
        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: var(--accent);
            color: white;
            padding: 16px 20px;
            border-radius: 12px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.2);
            z-index: 1000;
            animation: slideIn 0.3s ease-out;
            max-width: 320px;
        }
        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        .toast-title {
            font-weight: 600;
            margin-bottom: 4px;
        }
        .toast-body {
            font-size: 0.9rem;
            opacity: 0.9;
        }
        @media (max-width: 768px) {
            .app {
                padding: 24px;
            }
            .calendar-grid {
                gap: 6px;
            }
            .toast {
                right: 10px;
                left: 10px;
                max-width: none;
            }
        }
    </style>
</head>
<body>
    <div class="app">
        <section>
            <div class="calendar-header">
                <button id="prev-month" aria-label="‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤">‚Äπ</button>
                <h1 id="month-label"></h1>
                <button id="next-month" aria-label="‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ñ‡∏±‡∏î‡πÑ‡∏õ">‚Ä∫</button>
            </div>
            <div class="calendar-grid" id="calendar">
                <div class="weekday">‡∏≠‡∏≤</div>
                <div class="weekday">‡∏à</div>
                <div class="weekday">‡∏≠</div>
                <div class="weekday">‡∏û</div>
                <div class="weekday">‡∏û‡∏§</div>
                <div class="weekday">‡∏®</div>
                <div class="weekday">‡∏™</div>
            </div>
        </section>

        <form id="event-form">
            <label>
                ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà/‡πÄ‡∏ß‡∏•‡∏≤
                <input type="datetime-local" id="event-datetime" required>
            </label>
            <label>
                ‡∏ä‡∏∑‡πà‡∏≠‡∏á‡∏≤‡∏ô
                <input type="text" id="event-title" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏ô‡∏±‡∏î‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°‡∏ó‡∏µ‡∏°" required>
            </label>
            <label>
                ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î
                <textarea id="event-note" rows="2" placeholder="‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°"></textarea>
            </label>
            <label>
                ‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô (‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö)
                <div style="display: flex; gap: 8px; align-items: flex-start;">
                    <input type="email" id="event-email" placeholder="your-email@example.com" style="flex: 1;">
                </div>
                <small style="color: #64748b; font-size: 0.85rem;">‡∏Å‡∏£‡∏≠‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏à‡∏≥‡πÑ‡∏ß‡πâ‡πÉ‡∏ä‡πâ‡∏ï‡πà‡∏≠</small>
            </label>
            <button type="submit">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡∏∞‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</button>
            <div class="status" id="status-text">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÉ‡∏ô‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å</div>
        </form>

        <section class="events">
            <h2>‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</h2>
            <div id="event-list"></div>
        </section>
    </div>

    <!-- EmailJS SDK -->
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
    <script>
        // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ EmailJS (‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ñ‡πà‡∏≤‡πÄ‡∏´‡∏•‡πà‡∏≤‡∏ô‡∏µ‡πâ‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡∏™‡∏°‡∏±‡∏Ñ‡∏£ EmailJS)
        // ‡∏î‡∏π‡∏ß‡∏¥‡∏ò‡∏µ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà: https://www.emailjs.com/docs/
        const EMAILJS_CONFIG = {
            serviceID: 'service_ta1n86e',      // Service ID
            templateID: 'template_q0d7bey',   // Template ID
            publicKey: 'oZKQtMaF_awGWNYXz'    // Public Key
        };

        // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô EmailJS (‡∏£‡∏≠‡πÉ‡∏´‡πâ SDK ‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏™‡∏£‡πá‡∏à‡∏Å‡πà‡∏≠‡∏ô)
        window.addEventListener('load', function() {
            setTimeout(() => {
                if (typeof emailjs !== 'undefined') {
                    try {
                        emailjs.init(EMAILJS_CONFIG.publicKey);
                        console.log("‚úÖ EmailJS ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à", {
                            serviceID: EMAILJS_CONFIG.serviceID,
                            templateID: EMAILJS_CONFIG.templateID,
                            publicKey: EMAILJS_CONFIG.publicKey.substring(0, 5) + "..."
                        });
                    } catch (error) {
                        console.error("‚ùå EmailJS init error:", error);
                    }
                } else {
                    console.error("‚ùå EmailJS SDK ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÇ‡∏´‡∏•‡∏î - ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ CDN ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô");
                }
            }, 500);
        });
    </script>
    <script>
        const monthLabel = document.getElementById("month-label");
        const calendar = document.getElementById("calendar");
        const eventForm = document.getElementById("event-form");
        const eventList = document.getElementById("event-list");
        const statusText = document.getElementById("status-text");
        const eventDatetime = document.getElementById("event-datetime");
        const eventEmail = document.getElementById("event-email");

        // ‡πÇ‡∏´‡∏•‡∏î‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏ß‡πâ
        function loadSavedEmail() {
            const savedEmail = localStorage.getItem("calendar-email");
            if (savedEmail) {
                eventEmail.value = savedEmail;
            }
        }

        // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏≠‡∏µ‡πÄ‡∏°‡∏•
        function saveEmail() {
            if (eventEmail.value.trim()) {
                localStorage.setItem("calendar-email", eventEmail.value.trim());
            }
        }

        let today = new Date();
        let currentMonth = today.getMonth();
        let currentYear = today.getFullYear();
        let selectedDate = today;
        let events = [];
        let notificationTimeouts = new Map();

        // ‡πÇ‡∏´‡∏•‡∏î events ‡∏à‡∏≤‡∏Å localStorage
        function loadEvents() {
            const saved = localStorage.getItem("calendar-events");
            if (saved) {
                events = JSON.parse(saved);
                // ‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÉ‡∏´‡∏°‡πà‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö events ‡∏ó‡∏µ‡πà‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô‡πÄ‡∏ß‡∏•‡∏≤
                events.forEach(event => {
                    const eventTime = new Date(event.datetime).getTime();
                    if (eventTime > Date.now()) {
                        scheduleNotification(event);
                    }
                });
            }
        }

        // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å events ‡∏•‡∏á localStorage
        function saveEvents() {
            localStorage.setItem("calendar-events", JSON.stringify(events));
        }

        const WEEKDAYS = ["‡∏≠‡∏≤", "‡∏à", "‡∏≠", "‡∏û", "‡∏û‡∏§", "‡∏®", "‡∏™"];

        function renderCalendar() {
            monthLabel.textContent = new Date(currentYear, currentMonth).toLocaleDateString("th-TH", {
                year: "numeric",
                month: "long"
            });

            const firstDayOfMonth = new Date(currentYear, currentMonth, 1);
            const lastDayOfMonth = new Date(currentYear, currentMonth + 1, 0);
            const startWeekday = firstDayOfMonth.getDay();
            const totalDays = lastDayOfMonth.getDate();

            calendar.innerHTML = WEEKDAYS.map(day => `<div class="weekday">${day}</div>`).join("");

            for (let i = 0; i < startWeekday; i++) {
                calendar.innerHTML += `<div class="day inactive"></div>`;
            }

            for (let day = 1; day <= totalDays; day++) {
                const date = new Date(currentYear, currentMonth, day);
                const dateStr = date.toDateString();
                const hasEvent = events.some(ev => new Date(ev.datetime).toDateString() === dateStr);
                const isSelected = selectedDate.toDateString() === dateStr;

                calendar.innerHTML += `
                    <div class="day ${isSelected ? "selected" : ""}" data-date="${date.toISOString()}">
                        ${day}
                        ${hasEvent ? '<span class="indicator"></span>' : ""}
                    </div>
                `;
            }

            document.querySelectorAll(".day[data-date]").forEach(dayEl => {
                dayEl.addEventListener("click", () => {
                    selectedDate = new Date(dayEl.dataset.date);
                    eventDatetime.value = new Date(selectedDate.setHours(9, 0, 0, 0)).toISOString().slice(0, 16);
                    renderCalendar();
                });
            });
        }

        function requestNotificationPermission() {
            if (!("Notification" in window)) {
                statusText.textContent = "‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô";
                return;
            }
            Notification.requestPermission().then(permission => {
                statusText.textContent = permission === "granted"
                    ? "‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ï‡∏≤‡∏°‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏ï‡∏±‡πâ‡∏á‡πÑ‡∏ß‡πâ"
                    : "‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô";
            });
        }

        // ‡πÅ‡∏™‡∏î‡∏á toast notification ‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö
        function showToast(title, body) {
            const toast = document.createElement("div");
            toast.className = "toast";
            toast.innerHTML = `
                <div class="toast-title">${title}</div>
                <div class="toast-body">${body}</div>
            `;
            document.body.appendChild(toast);
            setTimeout(() => {
                toast.style.animation = "slideIn 0.3s ease-out reverse";
                setTimeout(() => toast.remove(), 300);
            }, 4000);
        }

        // ‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô
        function playNotificationSound() {
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.value = 800;
                oscillator.type = "sine";
                
                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
                
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.5);
            } catch (e) {
                console.log("‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÑ‡∏î‡πâ:", e);
            }
        }

        // ‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô
        function scheduleNotification(event) {
            const timeUntil = new Date(event.datetime).getTime() - Date.now();
            
            if (timeUntil <= 0) {
                // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏•‡∏¢‡πÄ‡∏ß‡∏•‡∏≤‡πÅ‡∏•‡πâ‡∏ß ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
                showNotification(event, "‡∏á‡∏≤‡∏ô‡πÄ‡∏•‡∏¢‡πÄ‡∏ß‡∏•‡∏≤‡πÅ‡∏•‡πâ‡∏ß");
                return;
            }

            // ‡∏•‡πâ‡∏≤‡∏á timeout ‡πÄ‡∏Å‡πà‡∏≤‡∏ñ‡πâ‡∏≤‡∏°‡∏µ
            if (notificationTimeouts.has(event.id)) {
                clearTimeout(notificationTimeouts.get(event.id));
            }

            // ‡∏ï‡∏±‡πâ‡∏á timeout ‡πÉ‡∏´‡∏°‡πà
            const timeoutId = setTimeout(() => {
                showNotification(event, "‡∏ñ‡∏∂‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏ï‡∏±‡πâ‡∏á‡πÑ‡∏ß‡πâ‡πÅ‡∏•‡πâ‡∏ß");
                // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
                event.status = "‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÅ‡∏•‡πâ‡∏ß";
                saveEvents();
                renderEvents();
                notificationTimeouts.delete(event.id);
            }, timeUntil);

            notificationTimeouts.set(event.id, timeoutId);
        }

        // ‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô
        async function sendEmailNotification(event, defaultBody) {
            const email = event.email || localStorage.getItem("calendar-email");
            
            console.log("üîç ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•:", { email, eventTitle: event.title });
            
            if (!email || !email.trim()) {
                console.warn("‚ö†Ô∏è ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏≠‡∏µ‡πÄ‡∏°‡∏• ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡πà‡∏á‡πÑ‡∏î‡πâ");
                return; // ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏≠‡∏µ‡πÄ‡∏°‡∏• ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏™‡πà‡∏á
            }

            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ EmailJS ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏£‡∏ö‡∏´‡∏£‡∏∑‡∏≠‡∏¢‡∏±‡∏á
            // ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤‡∏¢‡∏±‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡πà‡∏≤ default (YOUR_SERVICE_ID) ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà - ‡∏ñ‡πâ‡∏≤‡πÉ‡∏ä‡πà‡πÅ‡∏™‡∏î‡∏á‡∏ß‡πà‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤
            // ‚ö†Ô∏è ‡∏≠‡∏¢‡πà‡∏≤‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏™‡πà‡∏ß‡∏ô‡∏ô‡∏µ‡πâ! ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤‡∏¢‡∏±‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡πà‡∏≤ default ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
            const isDefaultConfig = 
                EMAILJS_CONFIG.serviceID === 'YOUR_SERVICE_ID' || 
                EMAILJS_CONFIG.templateID === 'YOUR_TEMPLATE_ID' ||
                EMAILJS_CONFIG.publicKey === 'YOUR_PUBLIC_KEY';
            
            if (isDefaultConfig) {
                console.error("‚ùå ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ EmailJS ‡∏Å‡πà‡∏≠‡∏ô‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô");
                return;
            }
            
            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏°‡∏µ‡∏Ñ‡πà‡∏≤‡∏à‡∏£‡∏¥‡∏á‡πÜ (‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡∏Ñ‡πà‡∏≤‡∏ß‡πà‡∏≤‡∏á)
            if (!EMAILJS_CONFIG.serviceID || !EMAILJS_CONFIG.templateID || !EMAILJS_CONFIG.publicKey) {
                console.error("‚ùå EmailJS Config ‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô");
                return;
            }

            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ emailjs ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
            if (typeof emailjs === 'undefined') {
                console.error("‚ùå EmailJS SDK ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÇ‡∏´‡∏•‡∏î");
                return;
            }

            console.log("‚úÖ EmailJS Config ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á:", {
                serviceID: EMAILJS_CONFIG.serviceID,
                templateID: EMAILJS_CONFIG.templateID,
                publicKey: EMAILJS_CONFIG.publicKey.substring(0, 5) + "..."
            });

            const eventDate = new Date(event.datetime).toLocaleString("th-TH", {
                year: "numeric",
                month: "long",
                day: "numeric",
                hour: "2-digit",
                minute: "2-digit"
            });

            const templateParams = {
                to_email: email,
                event_title: event.title,
                event_date: eventDate,
                event_note: event.note || defaultBody,
                event_datetime: new Date(event.datetime).toLocaleString("th-TH")
            };

            console.log("üìß Template Params:", templateParams);
            console.log("üì§ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•...");
            console.log("üîß ‡πÉ‡∏ä‡πâ Service:", EMAILJS_CONFIG.serviceID);
            console.log("üîß ‡πÉ‡∏ä‡πâ Template:", EMAILJS_CONFIG.templateID);

            try {
                const response = await emailjs.send(
                    EMAILJS_CONFIG.serviceID,
                    EMAILJS_CONFIG.templateID,
                    templateParams
                );
                console.log("‚úÖ ‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!", response);
                console.log("üì¨ Response Status:", response.status);
                console.log("üì¨ Response Text:", response.text);
                showToast("‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à", `‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÑ‡∏õ‡∏¢‡∏±‡∏á ${email} ‡πÅ‡∏•‡πâ‡∏ß`);
                return true;
            } catch (error) {
                console.error("‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πÑ‡∏î‡πâ:", error);
                console.error("üìã Error details:", {
                    status: error.status,
                    text: error.text,
                    message: error.message,
                    serviceID: EMAILJS_CONFIG.serviceID,
                    templateID: EMAILJS_CONFIG.templateID,
                    publicKey: EMAILJS_CONFIG.publicKey ? "‡∏°‡∏µ‡∏Ñ‡πà‡∏≤" : "‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡πà‡∏≤"
                });
                
                // ‡πÅ‡∏™‡∏î‡∏á error message ‡∏ó‡∏µ‡πà‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô
                let errorMsg = "‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î";
                if (error.status === 400) {
                    errorMsg = "Template ‡∏´‡∏£‡∏∑‡∏≠ Service ID ‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á - ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Template ‡πÉ‡∏ô EmailJS Dashboard";
                } else if (error.status === 401) {
                    errorMsg = "Public Key ‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á";
                } else if (error.status === 403) {
                    errorMsg = "‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á - ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Public Key";
                } else if (error.status === 404) {
                    errorMsg = "‡πÑ‡∏°‡πà‡∏û‡∏ö Service ‡∏´‡∏£‡∏∑‡∏≠ Template - ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö ID";
                } else if (error.status === 429) {
                    errorMsg = "‡πÄ‡∏Å‡∏¥‡∏ô‡πÇ‡∏Ñ‡∏ß‡∏ï‡πâ‡∏≤ (200 ‡∏≠‡∏µ‡πÄ‡∏°‡∏•/‡πÄ‡∏î‡∏∑‡∏≠‡∏ô)";
                } else if (error.text) {
                    errorMsg = error.text;
                } else if (error.message) {
                    errorMsg = error.message;
                }
                
                console.error("üí° ‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥: ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ Email Template ‡∏°‡∏µ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡πÄ‡∏´‡∏•‡πà‡∏≤‡∏ô‡∏µ‡πâ:");
                console.error("   - {{to_email}} ‡πÉ‡∏ô‡∏ä‡πà‡∏≠‡∏á 'To Email'");
                console.error("   - {{event_title}}, {{event_note}}, {{event_datetime}} ‡πÉ‡∏ô‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤");
                
                showToast("‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à", errorMsg);
                return false;
            }
        }

        // ‡πÅ‡∏™‡∏î‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô (Browser + Toast + Sound + Email)
        async function showNotification(event, defaultBody) {
            const body = event.note || defaultBody;
            
            // Browser Notification
            if ("Notification" in window && Notification.permission === "granted") {
                new Notification(event.title, { 
                    body: body,
                    icon: "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%233d7eff'%3E%3Cpath d='M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z'/%3E%3C/svg%3E"
                });
            }
            
            // Toast notification ‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö
            showToast(event.title, body);
            
            // ‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏™‡∏µ‡∏¢‡∏á
            playNotificationSound();

            // ‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•
            await sendEmailNotification(event, defaultBody);
        }

        function renderEvents() {
            if (!events.length) {
                eventList.innerHTML = "<p>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏á‡∏≤‡∏ô</p>";
                return;
            }
            eventList.innerHTML = events
                .map(event => `
                    <article class="event-card">
                        <div>
                            <strong>${event.title}</strong>
                            <div>${new Date(event.datetime).toLocaleString("th-TH")}</div>
                            ${event.note ? `<p>${event.note}</p>` : ""}
                        </div>
                        <small>${event.status}</small>
                    </article>
                `)
                .join("");
        }

        eventForm.addEventListener("submit", e => {
            e.preventDefault();
            const title = document.getElementById("event-title").value.trim();
            const datetime = eventDatetime.value;
            const note = document.getElementById("event-note").value.trim();
            const email = eventEmail.value.trim();

            if (!title || !datetime) {
                statusText.textContent = "‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô";
                return;
            }

            // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ñ‡πâ‡∏≤‡∏°‡∏µ
            if (email) {
                saveEmail();
            }

            const event = {
                id: crypto.randomUUID(),
                title,
                datetime,
                note,
                email: email || localStorage.getItem("calendar-email") || "",
                status: "‡∏£‡∏≠‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô"
            };
            events.push(event);
            saveEvents();
            scheduleNotification(event);
            renderCalendar();
            renderEvents();
            
            const emailStatus = email || localStorage.getItem("calendar-email") 
                ? " (‡∏£‡∏ß‡∏°‡∏ñ‡∏∂‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•)" 
                : "";
            statusText.textContent = `‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÉ‡∏´‡πâ‡∏ï‡∏≤‡∏°‡πÄ‡∏ß‡∏•‡∏≤${emailStatus}`;
            eventForm.reset();
            loadSavedEmail(); // ‡πÇ‡∏´‡∏•‡∏î‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏ß‡πâ‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤
        });

        document.getElementById("prev-month").addEventListener("click", () => {
            currentMonth--;
            if (currentMonth < 0) {
                currentMonth = 11;
                currentYear--;
            }
            renderCalendar();
        });

        document.getElementById("next-month").addEventListener("click", () => {
            currentMonth++;
            if (currentMonth > 11) {
                currentMonth = 0;
                currentYear++;
            }
            renderCalendar();
        });

        // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ó‡∏∏‡∏Å‡∏ô‡∏≤‡∏ó‡∏µ (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö events ‡∏ó‡∏µ‡πà‡∏≠‡∏≤‡∏à‡∏û‡∏•‡∏≤‡∏î)
        setInterval(() => {
            const now = Date.now();
            events.forEach(event => {
                const eventTime = new Date(event.datetime).getTime();
                const diff = eventTime - now;
                // ‡∏ñ‡πâ‡∏≤‡πÉ‡∏Å‡∏•‡πâ‡πÄ‡∏ß‡∏•‡∏≤ (‡∏†‡∏≤‡∏¢‡πÉ‡∏ô 1 ‡∏ô‡∏≤‡∏ó‡∏µ) ‡πÅ‡∏•‡∏∞‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô
                if (diff > 0 && diff <= 60000 && event.status === "‡∏£‡∏≠‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô") {
                    showNotification(event, "‡πÉ‡∏Å‡∏•‡πâ‡∏ñ‡∏∂‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏ï‡∏±‡πâ‡∏á‡πÑ‡∏ß‡πâ‡πÅ‡∏•‡πâ‡∏ß");
                    event.status = "‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÅ‡∏•‡πâ‡∏ß";
                    saveEvents();
                    renderEvents();
                }
            });
        }, 60000); // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ó‡∏∏‡∏Å 1 ‡∏ô‡∏≤‡∏ó‡∏µ

        // ‡∏õ‡∏∏‡πà‡∏°‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•
        document.getElementById("test-email-btn").addEventListener("click", async () => {
            const email = eventEmail.value.trim() || localStorage.getItem("calendar-email");
            
            if (!email) {
                statusText.textContent = "‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏Å‡πà‡∏≠‡∏ô‡∏ó‡∏î‡∏™‡∏≠‡∏ö";
                statusText.style.color = "#ef4444";
                return;
            }

            statusText.textContent = "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•...";
            statusText.style.color = "#475467";

            const testEvent = {
                id: "test",
                title: "‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô",
                datetime: new Date().toISOString(),
                note: "‡∏ô‡∏µ‡πà‡∏Ñ‡∏∑‡∏≠‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏à‡∏≤‡∏Å‡∏õ‡∏è‡∏¥‡∏ó‡∏¥‡∏ô M.5",
                email: email
            };

            try {
                await sendEmailNotification(testEvent, "‡∏ô‡∏µ‡πà‡∏Ñ‡∏∑‡∏≠‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ó‡∏î‡∏™‡∏≠‡∏ö");
                statusText.textContent = `‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÑ‡∏õ‡∏¢‡∏±‡∏á ${email} ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏à‡∏î‡∏´‡∏°‡∏≤‡∏¢`;
                statusText.style.color = "#10b981";
            } catch (error) {
                statusText.textContent = `‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ${error.message || "‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Console (F12)"}`;
                statusText.style.color = "#ef4444";
            }
        });

        loadEvents();
        loadSavedEmail();
        requestNotificationPermission();
        renderCalendar();
        renderEvents();
    </script>
</body>
</html>